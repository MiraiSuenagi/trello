// Подключение Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

// Конфигурация Firebase (замените на вашу)
const firebaseConfig = {
  apiKey: "AIzaSyCPjgBLKi47sdikhR6voAUIV1IrF4HV9ZQ", 
  authDomain: "trello-e87ad.firebaseapp.com", 
  projectId: "trello-e87ad", 
};

// Инициализация Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Функция добавления пользователя
async function addUser(email, password) {
  try {
    const docRef = await addDoc(collection(db, "users"), {
      email: email,
      password: password,
    });
    console.log("Пользователь добавлен с ID:", docRef.id);
  } catch (error) {
    console.error("Ошибка добавления пользователя:", error);
    alert("Ошибка добавления пользователя");
  }
}

// Функция получения пользователей
async function getUsers() {
  try {
    const querySnapshot = await getDocs(collection(db, "users"));
    const users = [];
    querySnapshot.forEach((doc) => {
      users.push({ id: doc.id, ...doc.data() });
    });
    return users;
  } catch (error) {
    console.error("Ошибка получения пользователей:", error);
    alert("Ошибка получения списка пользователей");
    return [];
  }
}

// Функция добавления проекта
async function addProject(projectName) {
  try {
    const docRef = await addDoc(collection(db, "projects"), {
      name: projectName,
    });
    console.log("Проект добавлен с ID:", docRef.id);
  } catch (error) {
    console.error("Ошибка добавления проекта:", error);
    alert("Ошибка добавления проекта");
  }
}

// Функция получения проектов
async function getProjects() {
  try {
    const querySnapshot = await getDocs(collection(db, "projects"));
    const projects = [];
    querySnapshot.forEach((doc) => {
      projects.push({ id: doc.id, ...doc.data() });
    });
    return projects;
  } catch (error) {
    console.error("Ошибка получения проектов:", error);
    alert("Ошибка получения списка проектов");
    return [];
  }
}

// Обновление интерфейса списка проектов
async function updateUI() {
  const projects = await getProjects();
  const projectList = document.getElementById('project-list');
  projectList.innerHTML = '';
  projects.forEach(project => {
    const projectButton = document.createElement('div');
    projectButton.className = 'project';
    projectButton.textContent = project.name;
    projectList.appendChild(projectButton);
  });
}

// Обработчики событий
const loginButton = document.getElementById('login-button');
if (loginButton) {
  loginButton.addEventListener('click', async () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const users = await getUsers();
    const user = users.find(u => u.email === email && u.password === password);

    if (user) {
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('admin-panel').style.display = email === 'admin@example.com' ? 'flex' : 'none';
      updateUI();
    } else {
      alert("Неверный email или пароль");
    }
  });
}

const addUserButton = document.getElementById('add-user-button');
if (addUserButton) {
  addUserButton.addEventListener('click', async () => {
    const email = document.getElementById('new-user-email').value.trim();
    const password = document.getElementById('new-user-password').value.trim();
    if (email && password) {
      await addUser(email, password);
      alert("Пользователь добавлен!");
    } else {
      alert("Введите email и пароль");
    }
  });
}

const projectList = document.getElementById('project-list');
if (projectList) {
  projectList.addEventListener('click', async () => {
    const projectName = prompt('Введите имя нового проекта:');
    if (projectName) {
      await addProject(projectName);
      updateUI();
    }
  });
}

// Инициализация интерфейса
updateUI();
