<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–æ–ø–∏—è Trello</title>
    <style>
        :root {
            --primary-color: #026aa7;
            --secondary-color: #0079bf;
            --background-color: #f0f2f5;
            --list-bg-color: #ebecf0;
            --card-bg-color: #fff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            padding: 0;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            display: flex;
            background-color: var(--primary-color);
            color: white;
            padding: 8px 16px;
            align-items: center;
            height: 40px;
        }

        .navbar-brand {
            font-size: 20px;
            font-weight: bold;
            margin-right: 16px;
        }

        .navbar-menu {
            display: flex;
            gap: 16px;
        }

        .navbar-item {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .navbar-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .navbar-search {
            margin-left: auto;
            padding: 4px 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            display: flex;
            align-items: center;
        }

        .navbar-search input {
            background: transparent;
            border: none;
            color: white;
            outline: none;
            width: 180px;
        }

        .navbar-search input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .board-header {
            background-color: rgba(0, 0, 0, 0.1);
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 48px;
        }

        .board-title {
            font-size: 18px;
            font-weight: bold;
        }

        .board-menu {
            display: flex;
            gap: 8px;
        }

        .board-button {
            padding: 6px 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .board-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .board-content {
            height: calc(100vh - 88px);
            padding: 16px;
            display: flex;
            overflow-x: auto;
            align-items: flex-start;
        }

        .list-wrapper {
            width: 272px;
            min-width: 272px;
            margin-right: 8px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .list {
            background-color: var(--list-bg-color);
            border-radius: 3px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            max-height: 100%;
        }

        .list-header {
            padding: 8px 4px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-title {
            cursor: pointer;
            padding: 4px;
            flex-grow: 1;
        }

        .list-title:hover {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .list-title-edit {
            display: none;
            width: 100%;
            padding: 4px;
            border: none;
            border-radius: 3px;
            box-shadow: inset 0 0 0 2px var(--secondary-color);
            outline: none;
        }

        .list-menu {
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .list-menu:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .list-cards {
            flex: 1;
            overflow-y: auto;
            min-height: 10px;
            margin: 0 4px;
        }

        .card {
            background-color: var(--card-bg-color);
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
            padding: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            position: relative;
        }

        .card:hover {
            background-color: #f7f9fa;
        }

        .card-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 4px;
        }

        .card-label {
            height: 8px;
            width: 40px;
            border-radius: 4px;
        }

        .label-green { background-color: #61bd4f; }
        .label-yellow { background-color: #f2d600; }
        .label-orange { background-color: #ff9f1a; }
        .label-red { background-color: #eb5a46; }
        .label-purple { background-color: #c377e0; }
        .label-blue { background-color: #0079bf; }

        .card-title {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .card-badges {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #5e6c84;
            margin-top: 4px;
        }

        .card-badge {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .add-card, .add-list {
            padding: 8px;
            border-radius: 3px;
            cursor: pointer;
            color: #5e6c84;
            margin-top: 8px;
            display: flex;
            align-items: center;
        }

        .add-card:hover, .add-list:hover {
            background-color: rgba(9, 30, 66, 0.08);
            color: #172b4d;
        }

        .add-list-wrapper {
            background-color: rgba(255, 255, 255, 0.24);
            width: 272px;
            min-width: 272px;
            border-radius: 3px;
            height: fit-content;
            padding: 4px;
            margin-right: 8px;
        }

        .card-composer, .list-composer {
            display: none;
            margin-top: 8px;
        }

        .card-composer textarea, .list-composer input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
            margin-bottom: 8px;
            resize: none;
            outline: none;
        }

        .composer-buttons {
            display: flex;
            align-items: center;
        }

        .add-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 8px;
        }

        .add-button:hover {
            background-color: var(--primary-color);
        }

        .cancel-button {
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .cancel-button:hover {
            background-color: rgba(9, 30, 66, 0.08);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: flex-start;
            padding-top: 48px;
        }

        .modal-card {
            background-color: #f4f5f7;
            border-radius: 3px;
            width: 768px;
            max-width: 95%;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 96px);
            overflow: hidden;
        }

        .modal-header {
            padding: 16px;
            position: relative;
            display: flex;
            align-items: flex-start;
        }

        .modal-close {
            position: absolute;
            top: 8px;
            right: 8px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background-color: rgba(9, 30, 66, 0.08);
        }

        .modal-title {
            width: 100%;
            margin-bottom: 16px;
        }

        .modal-title-input {
            width: 100%;
            font-size: 20px;
            font-weight: bold;
            padding: 8px;
            border: none;
            border-radius: 3px;
            background-color: transparent;
            margin-bottom: 8px;
        }

        .modal-title-input:focus {
            background-color: white;
            box-shadow: inset 0 0 0 2px var(--secondary-color);
            outline: none;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #5e6c84;
            margin-bottom: 8px;
        }

        .modal-content {
            display: flex;
            padding: 0 16px 16px;
            overflow: auto;
        }

        .modal-main {
            flex: 1;
            margin-right: 16px;
        }

        .modal-sidebar {
            width: 200px;
        }

        .modal-section {
            margin-bottom: 24px;
        }

        .modal-section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .modal-description {
            padding: 8px;
            min-height: 100px;
            background-color: white;
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
            cursor: pointer;
        }

        .modal-description:hover {
            background-color: #ebecf0;
        }

        .modal-description-edit {
            display: none;
            width: 100%;
            min-height: 100px;
            padding: 8px;
            border: none;
            border-radius: 3px;
            box-shadow: inset 0 0 0 2px var(--secondary-color);
            resize: vertical;
            margin-bottom: 8px;
            outline: none;
        }

        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sidebar-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 3px;
            cursor: pointer;
            color: #172b4d;
            background-color: #ebecf0;
        }

        .sidebar-button:hover {
            background-color: #dfe1e6;
        }

        .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        .dragging {
            opacity: 0.5;
        }

        .drop-indicator {
            height: 2px;
            background-color: var(--secondary-color);
            margin: 4px 0;
            display: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        #auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 16px;
        }

        #auth-container input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
        }

        #auth-container button {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #auth-container button:hover {
            background-color: var(--secondary-color);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .navbar, .board-header, .board-content {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="auth-container">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="sign-in">Sign In</button>
        <button id="sign-up">Sign Up</button>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="navbar">
        <div class="navbar-brand">Trello Clone</div>
        <div class="navbar-menu">
            <div class="navbar-item">–î–æ—Å–∫–∏</div>
            <div class="navbar-item">–°–æ–∑–¥–∞—Ç—å</div>
        </div>
        <div class="navbar-search">
            <input type="text" placeholder="–ü–æ–∏—Å–∫...">
        </div>
        <button id="sign-out">Sign Out</button>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ—Å–∫–∏ -->
    <div class="board-header">
        <div class="board-title" contenteditable="true">–ú–æ—è –¥–æ—Å–∫–∞</div>
        <div class="board-menu">
            <div class="board-button">
                <span class="icon">‚≠ê</span>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </div>
            <div class="board-button">
                <span class="icon">üë•</span>
                <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
            </div>
            <div class="board-button">
                <span class="icon">‚öôÔ∏è</span>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
        </div>
    </div>

    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ—Å–∫–∏ -->
    <div class="board-content" id="boardContent">
        <div class="add-list-wrapper">
            <div class="add-list" id="addListButton">
                <span class="icon">+</span>
                <span>–î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫</span>
            </div>
            <div class="list-composer" id="listComposer">
                <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞...">
                <div class="composer-buttons">
                    <button class="add-button" id="submitListButton">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <div class="cancel-button" id="cancelListButton">‚úï</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="modal-overlay" id="cardModal">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">
                    <input type="text" class="modal-title-input" id="modalCardTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏">
                    <div class="modal-subtitle">–≤ —Å–ø–∏—Å–∫–µ <span id="modalListName">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞</span></div>
                </div>
                <div class="modal-close" id="closeCardModal">‚úï</div>
            </div>
            <div class="modal-content">
                <div class="modal-main">
                    <div class="modal-section">
                        <div class="modal-section-title">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                        <div class="modal-description" id="modalDescription">–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...</div>
                        <textarea class="modal-description-edit" id="modalDescriptionEdit" placeholder="–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
                    </div>
                    <div class="modal-section">
                        <div class="modal-section-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
                        <div id="commentSection">
                            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                </div>
                <div class="modal-sidebar">
                    <div class="sidebar-buttons">
                        <div class="sidebar-button">
                            <span class="icon">üè∑Ô∏è</span>
                            <span>–ú–µ—Ç–∫–∏</span>
                        </div>
                        <div class="sidebar-button">
                            <span class="icon">üë•</span>
                            <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                        </div>
                        <div class="sidebar-button">
                            <span class="icon">üìé</span>
                            <span>–í–ª–æ–∂–µ–Ω–∏–µ</span>
                        </div>
                        <div class="sidebar-button">
                            <span class="icon">üìã</span>
                            <span>–ß–µ–∫-–ª–∏—Å—Ç</span>
                        </div>
                        <div class="sidebar-button">
                            <span class="icon">üìÖ</span>
                            <span>–î–∞—Ç–∞</span>
                        </div>
                        <div class="sidebar-button">
                            <span class="icon">üóëÔ∏è</span>
                            <span>–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã –¥–ª—è JavaScript -->
    <template id="listTemplate">
        <div class="list-wrapper" data-list-id="">
            <div class="list">
                <div class="list-header">
                    <div class="list-title"></div>
                    <input type="text" class="list-title-edit">
                    <div class="list-menu">‚ãÆ</div>
                </div>
                <div class="list-cards"></div>
                <div class="add-card">
                    <span class="icon">+</span>
                    <span>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</span>
                </div>
                <div class="card-composer">
                    <textarea placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏..."></textarea>
                    <div class="composer-buttons">
                        <button class="add-button">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                        <div class="cancel-button">‚úï</div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="cardTemplate">
        <div class="card" data-card-id="">
            <div class="card-labels"></div>
            <div class="card-title"></div>
            <div class="card-badges">
                <div class="card-badge">
                    <span class="icon">üìù</span>
                    <span>0</span>
                </div>
                <div class="card-badge">
                    <span class="icon">üí¨</span>
                    <span>0</span>
                </div>
            </div>
        </div>
    </template>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyANrrrtTUCnTknIzjBh1WZ0qIILwn1Y8Mk",
            authDomain: "trello1231-3365e.firebaseapp.com",
            projectId: "trello1231-3365e",
            storageBucket: "trello1231-3365e.firebasestorage.app",
            messagingSenderId: "176568505073",
            appId: "1:176568505073:web:7f4fc8fa5315fd2f490f50",
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const authContainer = document.getElementById('auth-container');
        const navbar = document.querySelector('.navbar');
        const boardHeader = document.querySelector('.board-header');
        const boardContent = document.getElementById('boardContent');
        const signOutButton = document.getElementById('sign-out');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.getElementById('sign-in').addEventListener('click', function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log('User signed in:', user);
                    showAppContent();
                })
                .catch((error) => {
                    console.error('Error signing in:', error.message);
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                });
        });

        document.getElementById('sign-up').addEventListener('click', function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log('User signed up:', user);
                    showAppContent();
                })
                .catch((error) => {
                    console.error('Error signing up:', error.message);
                    alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
                });
        });

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        signOutButton.addEventListener('click', function() {
            signOut(auth).then(() => {
                console.log('User signed out');
                showAuthForm();
            }).catch((error) => {
                console.error('Error signing out:', error.message);
            });
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User is signed in:', user);
                showAppContent();
            } else {
                console.log('User is signed out');
                showAuthForm();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function showAppContent() {
            authContainer.style.display = 'none';
            navbar.style.display = 'flex';
            boardHeader.style.display = 'flex';
            boardContent.style.display = 'flex';
            signOutButton.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthForm() {
            authContainer.style.display = 'flex';
            navbar.style.display = 'none';
            boardHeader.style.display = 'none';
            boardContent.style.display = 'none';
            signOutButton.style.display = 'none';
        }

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            let lists = [];
            let cards = [];
            let nextListId = 1;
            let nextCardId = 1;
            let cardBeingDragged = null;
            let dropTarget = null;
            let currentCardId = null;

            const addListButton = document.getElementById('addListButton');
            const listComposer = document.getElementById('listComposer');
            const listInput = listComposer.querySelector('input');
            const submitListButton = document.getElementById('submitListButton');
            const cancelListButton = document.getElementById('cancelListButton');
            const cardModal = document.getElementById('cardModal');
            const closeCardModal = document.getElementById('closeCardModal');
            const modalCardTitle = document.getElementById('modalCardTitle');
            const modalListName = document.getElementById('modalListName');
            const modalDescription = document.getElementById('modalDescription');
            const modalDescriptionEdit = document.getElementById('modalDescriptionEdit');

            const listTemplate = document.getElementById('listTemplate');
            const cardTemplate = document.getElementById('cardTemplate');

            function createList(title) {
                const listId = `list-${nextListId++}`;
                const list = {
                    id: listId,
                    title: title
                };
                lists.push(list);
                renderList(list);
                return list;
            }

            function createCard(listId, title) {
                const cardId = `card-${nextCardId++}`;
                const card = {
                    id: cardId,
                    listId: listId,
                    title: title,
                    description: '',
                    labels: [],
                    comments: []
                };
                cards.push(card);
                renderCard(card);
                return card;
            }

            function renderList(list) {
                const clone = document.importNode(listTemplate.content, true);
                const listWrapper = clone.querySelector('.list-wrapper');
                const listTitle = clone.querySelector('.list-title');
                const listTitleEdit = clone.querySelector('.list-title-edit');
                const addCardButton = clone.querySelector('.add-card');
                const cardComposer = clone.querySelector('.card-composer');
                const cardTextarea = cardComposer.querySelector('textarea');
                const addCardSubmit = cardComposer.querySelector('.add-button');
                const cancelCardButton = cardComposer.querySelector('.cancel-button');

                listWrapper.dataset.listId = list.id;
                listTitle.textContent = list.title;

                const listCards = cards.filter(card => card.listId === list.id);
                const listCardsContainer = clone.querySelector('.list-cards');
                listCards.forEach(card => {
                    const cardElement = renderCardElement(card);
                    listCardsContainer.appendChild(cardElement);
                });

                listTitle.addEventListener('click', function() {
                    listTitle.style.display = 'none';
                    listTitleEdit.style.display = 'block';
                    listTitleEdit.value = listTitle.textContent;
                    listTitleEdit.focus();
                });

                listTitleEdit.addEventListener('blur', function() {
                    listTitle.style.display = 'block';
                    listTitleEdit.style.display = 'none';
                    if (listTitleEdit.value.trim() !== '') {
                        listTitle.textContent = listTitleEdit.value;
                        list.title = listTitleEdit.value;
                    }
                });

                listTitleEdit.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        listTitleEdit.blur();
                    }
                });

                addCardButton.addEventListener('click', function() {
                    addCardButton.style.display = 'none';
                    cardComposer.style.display = 'block';
                    cardTextarea.focus();
                });

                addCardSubmit.addEventListener('click', function() {
                    if (cardTextarea.value.trim() !== '') {
                        const card = createCard(list.id, cardTextarea.value.trim());
                        const cardElement = renderCardElement(card);
                        listCardsContainer.appendChild(cardElement);
                        cardTextarea.value = '';
                    }
                    cardComposer.style.display = 'none';
                    addCardButton.style.display = 'flex';
                });

                cancelCardButton.addEventListener('click', function() {
                    cardTextarea.value = '';
                    cardComposer.style.display = 'none';
                    addCardButton.style.display = 'flex';
                });

                listCardsContainer.addEventListener('dragover', function(e) {
                    e.preventDefault();

                    const afterElement = getDragAfterElement(listCardsContainer, e.clientY);
                    const dropIndicator = listCardsContainer.querySelector('.drop-indicator');

                    if (dropIndicator) {
                        dropIndicator.remove();
                    }

                    if (afterElement == null) {
                        listCardsContainer.appendChild(createDropIndicator());
                    } else {
                        listCardsContainer.insertBefore(createDropIndicator(), afterElement);
                    }

                    dropTarget = {
                        listId: list.id,
                        afterElement: afterElement
                    };
                });

                listCardsContainer.addEventListener('dragleave', function() {
                    const dropIndicator = listCardsContainer.querySelector('.drop-indicator');
                    if (dropIndicator) {
                        dropIndicator.remove();
                    }
                });

                listCardsContainer.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const dropIndicator = listCardsContainer.querySelector('.drop-indicator');
                    if (dropIndicator) {
                        dropIndicator.remove();
                    }

                    if (cardBeingDragged) {
                        const card = cards.find(c => c.id === cardBeingDragged);
                        if (card) {
                            const oldListId = card.listId;
                            card.listId = list.id;

                            const cardElement = document.querySelector(`[data-card-id="${card.id}"]`);
                            cardElement.classList.remove('dragging');

                            if (dropTarget.afterElement == null) {
                                listCardsContainer.appendChild(cardElement);
                            } else {
                                listCardsContainer.insertBefore(cardElement, dropTarget.afterElement);
                            }
                        }
                        cardBeingDragged = null;
                    }
                });

                boardContent.insertBefore(clone, document.querySelector('.add-list-wrapper'));
            }

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;

                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function createDropIndicator() {
                const indicator = document.createElement('div');
                indicator.className = 'drop-indicator';
                indicator.style.display = 'block';
                return indicator;
            }

            function renderCard(card) {
                const listCardsContainer = document.querySelector(`[data-list-id="${card.listId}"] .list-cards`);
                if (listCardsContainer) {
                    const cardElement = renderCardElement(card);
                    listCardsContainer.appendChild(cardElement);
                }
            }

            function renderCardElement(card) {
                const clone = document.importNode(cardTemplate.content, true);
                const cardElement = clone.querySelector('.card');
                const cardTitle = clone.querySelector('.card-title');
                const cardLabels = clone.querySelector('.card-labels');

                cardElement.dataset.cardId = card.id;
                cardTitle.textContent = card.title;

                if (card.labels && card.labels.length > 0) {
                    card.labels.forEach(label => {
                        const labelElement = document.createElement('div');
                        labelElement.className = `card-label label-${label}`;
                        cardLabels.appendChild(labelElement);
                    });
                }

                cardElement.addEventListener('click', function() {
                    openCardModal(card);
                });

                cardElement.setAttribute('draggable', 'true');

                cardElement.addEventListener('dragstart', function() {
                    cardElement.classList.add('dragging');
                    cardBeingDragged = card.id;
                });

                cardElement.addEventListener('dragend', function() {
                    cardElement.classList.remove('dragging');

                    document.querySelectorAll('.drop-indicator').forEach(indicator => {
                        indicator.remove();
                    });
                });

                return cardElement;
            }

            function openCardModal(card) {
                currentCardId = card.id;
                modalCardTitle.value = card.title;
                const list = lists.find(l => l.id === card.listId);
                modalListName.textContent = list ? list.title : '';

                modalDescription.textContent = card.description || '–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...';
                modalDescriptionEdit.value = card.description || '';

                cardModal.style.display = 'flex';

                modalCardTitle.focus();
            }

            function getCard(cardId) {
                return cards.find(card => card.id === cardId);
            }

            function updateCardTitle(cardId, newTitle) {
                const card = getCard(cardId);
                if (card) {
                    card.title = newTitle;
                    const cardElement = document.querySelector(`[data-card-id="${cardId}"] .card-title`);
                    if (cardElement) {
                        cardElement.textContent = newTitle;
                    }
                }
            }

            function updateCardDescription(cardId, newDescription) {
                const card = getCard(cardId);
                if (card) {
                    card.description = newDescription;
                }
            }

            function addLabelToCard(cardId, label) {
                const card = getCard(cardId);
                if (card && !card.labels.includes(label)) {
                    card.labels.push(label);
                    const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
                    if (cardElement) {
                        const labelsContainer = cardElement.querySelector('.card-labels');
                        const labelElement = document.createElement('div');
                        labelElement.className = `card-label label-${label}`;
                        labelsContainer.appendChild(labelElement);
                    }
                }
            }

            addListButton.addEventListener('click', function() {
                addListButton.style.display = 'none';
                listComposer.style.display = 'block';
                listInput.focus();
            });

            submitListButton.addEventListener('click', function() {
                if (listInput.value.trim() !== '') {
                    createList(listInput.value.trim());
                    listInput.value = '';
                }
                listComposer.style.display = 'none';
                addListButton.style.display = 'flex';
            });

            cancelListButton.addEventListener('click', function() {
                listInput.value = '';
                listComposer.style.display = 'none';
                addListButton.style.display = 'flex';
            });

            listInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitListButton.click();
                }
            });

            closeCardModal.addEventListener('click', function() {
                cardModal.style.display = 'none';
                saveCardChanges();
            });

            cardModal.addEventListener('click', function(e) {
                if (e.target === cardModal) {
                    cardModal.style.display = 'none';
                    saveCardChanges();
                }
            });

            modalCardTitle.addEventListener('input', function() {
                if (currentCardId) {
                    updateCardTitle(currentCardId, modalCardTitle.value);
                }
            });

            modalDescription.addEventListener('click', function() {
                modalDescription.style.display = 'none';
                modalDescriptionEdit.style.display = 'block';
                modalDescriptionEdit.focus();
            });

            modalDescriptionEdit.addEventListener('blur', function() {
                modalDescription.style.display = 'block';
                modalDescriptionEdit.style.display = 'none';
                if (currentCardId) {
                    const description = modalDescriptionEdit.value.trim();
                    updateCardDescription(currentCardId, description);
                    modalDescription.textContent = description || '–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...';
                }
            });

            function saveCardChanges() {
                if (currentCardId) {
                    const title = modalCardTitle.value.trim();
                    const description = modalDescriptionEdit.value.trim();

                    if (title !== '') {
                        updateCardTitle(currentCardId, title);
                    }

                    updateCardDescription(currentCardId, description);
                }
                currentCardId = null;
            }

            function initializeApp() {
                const todoList = createList('–°–¥–µ–ª–∞—Ç—å');
                const inProgressList = createList('–í –ø—Ä–æ—Ü–µ—Å—Å–µ');
                const doneList = createList('–ì–æ—Ç–æ–≤–æ');

                createCard(todoList.id, '–°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É –∫–æ–º–∞–Ω–¥—ã');
                createCard(todoList.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞');

                const card = createCard(inProgressList.id, '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞');
                cards.find(c => c.id === card.id).labels = ['green', 'red'];
                const cardElement = document.querySelector(`[data-card-id="${card.id}"]`);
                const labelsContainer = cardElement.querySelector('.card-labels');
                ['green', 'red'].forEach(label => {
                    const labelElement = document.createElement('div');
                    labelElement.className = `card-label label-${label}`;
                    labelsContainer.appendChild(labelElement);
                });

                createCard(inProgressList.id, '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π');
                createCard(doneList.id, '–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö');
                createCard(doneList.id, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }

            initializeApp();
        });
    </script>
</body>
</html>
