<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Система управления проектами</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f5f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    #project-list, #task-board {
      width: 90%;
      max-width: 1200px;
      margin-top: 20px;
    }

    #project-list .project {
      padding: 10px;
      margin: 10px 0;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-radius: 5px;
      cursor: pointer;
    }

    #task-board {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .column {
      flex: 1;
      background-color: #e2e4e6;
      padding: 10px;
      border-radius: 5px;
    }

    .column h3 {
      text-align: center;
    }

    .task {
      padding: 10px;
      margin: 10px 0;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-radius: 5px;
      cursor: grab;
    }

    .task.dragging {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div id="project-list">
    <h2>Проекты</h2>
    <div id="projects"></div>
    <button id="add-project">Добавить проект</button>
  </div>

  <div id="task-board" style="display: none;">
    <h2 id="current-project-title">Проект: </h2>
    <button id="back-to-projects">Назад к проектам</button>
    <div class="column" data-status="to-do">
      <h3>To Do</h3>
      <div class="task-container"></div>
    </div>
    <div class="column" data-status="doing">
      <h3>Doing</h3>
      <div class="task-container"></div>
    </div>
    <div class="column" data-status="done">
      <h3>Done</h3>
      <div class="task-container"></div>
    </div>
    <button id="add-task">Добавить задачу</button>
  </div>

  <script>
    const projectListContainer = document.getElementById("projects");
    const taskBoard = document.getElementById("task-board");
    const currentProjectTitle = document.getElementById("current-project-title");
    const backToProjectsButton = document.getElementById("back-to-projects");
    const addProjectButton = document.getElementById("add-project");
    const addTaskButton = document.getElementById("add-task");

    let projects = {};
    let currentProject = null;

    // Отображение списка проектов
    function renderProjects() {
      projectListContainer.innerHTML = "";
      Object.keys(projects).forEach((projectName) => {
        const projectDiv = document.createElement("div");
        projectDiv.className = "project";
        projectDiv.textContent = projectName;
        projectDiv.addEventListener("click", () => openProject(projectName));
        projectListContainer.appendChild(projectDiv);
      });
    }

    // Открытие проекта
    function openProject(projectName) {
      currentProject = projectName;
      currentProjectTitle.textContent = `Проект: ${projectName}`;
      renderTasks();
      document.getElementById("project-list").style.display = "none";
      taskBoard.style.display = "block";
    }

    // Возврат к списку проектов
    backToProjectsButton.addEventListener("click", () => {
      taskBoard.style.display = "none";
      document.getElementById("project-list").style.display = "block";
      currentProject = null;
    });

    // Добавление нового проекта
    addProjectButton.addEventListener("click", () => {
      const projectName = prompt("Введите название проекта:");
      if (projectName && !projects[projectName]) {
        projects[projectName] = { "to-do": [], "doing": [], "done": [] };
        renderProjects();
      }
    });

    // Отображение задач в текущем проекте
    function renderTasks() {
      const columns = document.querySelectorAll(".column");
      columns.forEach((column) => {
        const status = column.getAttribute("data-status");
        const taskContainer = column.querySelector(".task-container");
        taskContainer.innerHTML = "";
        projects[currentProject][status].forEach((task) => {
          const taskDiv = document.createElement("div");
          taskDiv.className = "task";
          taskDiv.draggable = true;
          taskDiv.textContent = task;
          taskDiv.addEventListener("dragstart", handleDragStart);
          taskDiv.addEventListener("dragend", handleDragEnd);
          taskContainer.appendChild(taskDiv);
        });
      });
    }

    // Добавление новой задачи
    addTaskButton.addEventListener("click", () => {
      const taskName = prompt("Введите название задачи:");
      if (taskName) {
        projects[currentProject]["to-do"].push(taskName);
        renderTasks();
      }
    });

    // Drag and Drop
    let draggedTask = null;

    function handleDragStart(e) {
      draggedTask = e.target;
      draggedTask.classList.add("dragging");
    }

    function handleDragEnd(e) {
      draggedTask.classList.remove("dragging");
      draggedTask = null;
    }

    document.querySelectorAll(".column").forEach((column) => {
      const taskContainer = column.querySelector(".task-container");

      taskContainer.addEventListener("dragover", (e) => {
        e.preventDefault();
        const draggingTask = document.querySelector(".dragging");
        taskContainer.appendChild(draggingTask);
      });

      taskContainer.addEventListener("drop", (e) => {
        const status = column.getAttribute("data-status");
        const taskName = draggedTask.textContent;
        const previousStatus = Object.keys(projects[currentProject]).find((key) =>
          projects[currentProject][key].includes(taskName)
        );

        // Обновляем данные
        projects[currentProject][previousStatus] = projects[currentProject][previousStatus].filter(
          (task) => task !== taskName
        );
        projects[currentProject][status].push(taskName);

        renderTasks();
      });
    });

    // Начальная отрисовка
    renderProjects();
  </script>
</body>
</html>
