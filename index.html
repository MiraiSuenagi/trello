// Подключение Supabase SDK
const { createClient } = supabase;

// Инициализация клиента Supabase
const supabaseUrl = 'https://nxvvqphmglylnbeoypze.supabase.co'; // Строка 5: Вставьте ваш URL Supabase
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54dnZxcGhtZ2x5bG5iZW95cHplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY3NjczNzgsImV4cCI6MjA1MjM0MzM3OH0.4I4TOuedoeUba4_txr_TmrwfQzZXaXAMvGbllTwZIAo'; // Строка 6: Вставьте ваш ключ API Supabase
const supabase = createClient(supabaseUrl, supabaseKey);

// Функция авторизации
async function login(email, password) {
  const { data, error } = await supabase.auth.signInWithPassword({ email, password });
  if (error) {
    alert('Ошибка авторизации: ' + error.message);
    return null;
  }
  return data.user;
}

// Функция регистрации нового пользователя
async function registerUser(email, password) {
  const { data, error } = await supabase.auth.signUp({ email, password });
  if (error) {
    alert('Ошибка регистрации: ' + error.message);
    return null;
  }
  return data.user;
}

// Получение списка пользователей
async function getUsers() {
  const { data, error } = await supabase.from('users').select('*');
  if (error) {
    alert('Ошибка получения списка пользователей: ' + error.message);
    return [];
  }
  return data;
}

// Сохранение нового пользователя в таблицу
async function addUser(email, password) {
  const { error } = await supabase.from('users').insert([{ email, password }]);
  if (error) {
    alert('Ошибка добавления пользователя: ' + error.message);
  } else {
    alert('Пользователь добавлен успешно!');
  }
}

// Получение проектов
async function getProjects() {
  const { data, error } = await supabase.from('projects').select('*');
  if (error) {
    alert('Ошибка загрузки проектов: ' + error.message);
    return [];
  }
  return data;
}

// Добавление нового проекта
async function addProject(projectName) {
  const { error } = await supabase.from('projects').insert([{ name: projectName }]);
  if (error) {
    alert('Ошибка добавления проекта: ' + error.message);
  } else {
    alert('Проект добавлен успешно!');
  }
}

// Обновление интерфейса для работы с базой данных
async function updateUI() {
  const projects = await getProjects();
  projectList.innerHTML = '';
  projects.forEach(project => {
    const projectButton = document.createElement('div');
    projectButton.className = 'project';
    projectButton.textContent = project.name;
    projectList.appendChild(projectButton);
  });
}

// Инициализация приложения
document.getElementById('login-button').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  const user = await login(email, password);
  if (user) {
    authContainer.style.display = 'none';
    adminPanel.style.display = user.email === 'admin@example.com' ? 'flex' : 'none';
    updateUI();
  }
});

document.getElementById('add-user-button').addEventListener('click', async () => {
  const email = document.getElementById('new-user-email').value.trim();
  const password = document.getElementById('new-user-password').value.trim();
  await addUser(email, password);
});

projectList.addEventListener('click', async () => {
  const projectName = prompt('Введите имя нового проекта:');
  if (projectName) {
    await addProject(projectName);
    updateUI();
  }
});

updateUI();
